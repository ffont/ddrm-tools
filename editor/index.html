<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="3rdparty/bootstrap.min.css">
	<link rel="stylesheet" href="3rdparty/bootstrap-slider.min.css">
	<link rel="stylesheet" href="all.css">

	<title>DDRM Timbre Space Demo</title>
</head>

<body onload="init();">

	<div id="timbreSpaceBgPad"></div>

	<div id="header">
		<div id="aboutButton"><a href="javascript:void(0);" onclick="showSettingsModal()">about</a></div>
		<img src="logo.svg" alt="Deckard's Dream Timbre Space Demo" title="Deckard's Dream Timbre Space Demo"/>
		<br>
		Base space on: <a id="factorySpaceButton" href="javascript:void(0);" onclick="setFactoryPresetsSpace();">Factory presets</a> | <a id="cs80SpaceButton" href="javascript:void(0);" onclick="setCS80Space();">Paul's CS80 bank</a>
	</div>

	<div id="timbreSpacePad"></div>

	<div id="settingsModal" style="display:none;">
		<div id="innerModal">
			<b>About Deckard's Dream Timbre Space</b>
			<p>bla bla bla</p>
			<br>
			<div id="midiSettings"></div>
			<br><br>
			<a href="javascript:void(0);" onclick="hideSettingsModal()">close</a>
		</div>
	</div>

	<div id="bottomPanel">
		<div id="bottomPanelToggleControls">
			<a href="javascript:void(0);" id="bottomPanelToggleControlsAnchor" onclick="toggleBottomPanel()"></a>	
		</div>
		<div id="synthControls"></div>
	</div>

	<div class="hiddenStuff" style="display:none;">
		<label>Load presets from bank file:</label>
		<form action='#' onsubmit="return false;">
			<input type='file' id='fileinput'>
			<button id='btnLoad' onclick='loadBankFile();'>Load</button>
		</form>
		<br>
		<div id="presetTitle"></div>
		<br>
		<div id="presetMetadata"></div>
		<br>
		<div id="presetManagerControls"></div>
		<br>
		<div id="controlsPanelActions"></div>
		<br>
		<div id="timbreSpaceButtons"></div>
	</div>

	<!-- JS -->
	<script type="text/javascript" src="3rdparty/noise.js"></script> <!-- TODO: credit this in README -->
	<script type="text/javascript" src="3rdparty/graphics.js"></script>  <!-- TODO: credit this in README -->
	<script type='text/javascript' src='3rdparty/delaunator.min.js'></script>  <!-- TODO: attribution https://github.com/mapbox/delaunator -->
	<script type='text/javascript' src='3rdparty/jquery.min.js'></script>
	<script type='text/javascript' src='3rdparty/bootstrap.min.js'></script>
	<script type='text/javascript' src='3rdparty/bootstrap-slider.min.js'></script>
	<script type='text/javascript' src='3rdparty/tabletop.min.js'></script>
	<script type='text/javascript' src='3rdparty/webmidi.min.js'></script>
	<script type='text/javascript' src='3rdparty/tsne.js'></script>
	<script type='text/javascript' src='globals.js'></script>
	<script type='text/javascript' src='utils.js'></script>
	<script type='text/javascript' src='midi.js'></script>
	<script type='text/javascript' src='store.js'></script>
	<script type='text/javascript' src='components.js'></script>
	<script type='text/javascript' src='ui.js'></script>
	<script type='text/javascript' src='space.js'></script>
	<script type='text/javascript'>
		function init() {
			initMIDI(document.getElementById("midiSettings"));
			SYNTH_UI_SCALE_FACTOR = 0.52;  // Use a fixed scale. Can also be automatically adjusted using autoAdjustUIScaleFactor()

			ONLINE_STORE = new GoogleSpreadsheetStore(
				scriptURL = "https://script.google.com/macros/s/AKfycbxdlE7J-VHEfSAEtj-MtA_MptxmtiMUWTbRU9oaU3zaZ-cSptW-/exec",
				spreadsheetURL = "https://docs.google.com/spreadsheets/d/10FpFlL8FKWJzRu2La21AdD-nhivl-7agzHNiIhQ5Llg/edit?usp=sharing");

			LOCAL_STORE = new LocalStore();
			PRESET_MANAGER = new PresetManager();

			loadBankFromBytesArray("Factory Presets", FACTORY_BANK_BYTES);
			loadBankFromBytesArray("Paul Shilling's CS80 presets", CS80_BANK_BYTES);
			drawPresetControls();
			drawPresetManagerControls();

			PRESET_MANAGER.loadLocalAndOnlinePresets(function () {
				if (PRESET_MANAGER.currentPreset === undefined) {
					PRESET_MANAGER.setCurrentPresetToFirstPreset();
					drawPresetControls();
					//drawPresetManagerControls();
				}
			});

			PRESET_SPACE = new PresetSpace();
			//drawPresetSpaceControls();
			//document.getElementById("buildSpaceBtnId").click();
			setFactoryPresetsSpace();
			
			toggleBottomPanel(); // Initially close bottom controls panel
		}

		function setFactoryPresetsSpace(){
			document.getElementById("factorySpaceButton").style.textDecoration = "underline";
			document.getElementById("cs80SpaceButton").style.textDecoration = "none";
			blockUI();
			setTimeout(() => { // Using a timeout here so blockUI() is rendered before browser is busy computing maps
				PRESET_SPACE.createSpace(PRESET_MANAGER.getPresetsDictionary()['Factory Presets'], function () {
					unblockUI();
					drawPresetSpacePad();
					drawPresetSpaceControls();
				});
			}, 200);
		}

		function setCS80Space() {
			document.getElementById("cs80SpaceButton").style.textDecoration = "underline";
			document.getElementById("factorySpaceButton").style.textDecoration = "none";
			blockUI();
			setTimeout(() => { // Using a timeout here so blockUI() is rendered before browser is busy computing maps
				PRESET_SPACE.createSpace(PRESET_MANAGER.getPresetsDictionary()["Paul Shilling's CS80 presets"], function () {
					unblockUI();
					drawPresetSpacePad();
					drawPresetSpaceControls();
				});
			}, 200);
		}

		function showSettingsModal(){
			document.getElementById("settingsModal").style.display = "block";
		}

		function hideSettingsModal() {
			document.getElementById("settingsModal").style.display = "none";
		}

	</script>
</body>

</html>